<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lucky 3-Digit Draw</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 24px; }
    .wrap { display: grid; grid-template-columns: 1fr 340px; gap: 16px; align-items: start; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 16px; box-shadow: 0 1px 6px rgba(0,0,0,.06); background: #fff; }
    .digits { display: flex; gap: 12px; justify-content: center; margin: 18px 0 10px; }
    .digit {
      width: 90px; height: 110px; display: grid; place-items: center;
      border-radius: 18px; border: 2px solid #111; font-size: 64px; font-weight: 800;
      letter-spacing: 2px;
    }
    .muted { color: #666; font-size: 14px; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 12px; }
    button { padding: 10px 14px; border-radius: 12px; border: 1px solid #111; background: #111; color: #fff; cursor: pointer; }
    button.secondary { background: #fff; color: #111; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    ul { margin: 10px 0 0; padding: 0 0 0 18px; }
    li { margin: 6px 0; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 18px; }
    .row { display: flex; gap: 10px; align-items: center; justify-content: space-between; }
    .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid #ddd; font-size: 13px; }

    /* Fullscreen polish (we toggle .fullscreen on <html>) */
    .fullscreen body { margin: 0; }
    .fullscreen .wrap { grid-template-columns: 1fr 380px; padding: 18px; }
    .fullscreen .digit { width: 140px; height: 160px; font-size: 96px; }
    .fullscreen h2 { font-size: 28px; margin-top: 8px; }
    .fullscreen .card { border-radius: 18px; }

    /* Confetti canvas overlays everything */
    #confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>

  <h2>üéüÔ∏è Lucky 3-Digit Draw</h2>
  <p class="muted">‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‚Äù ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏¢‡∏≠‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏£‡∏ö 3 ‡∏ï‡∏±‡∏ß‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ~7 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏õ‡∏à‡∏ô‡∏à‡∏ö)</p>

  <!-- IMPORTANT: put drum-roll2.mp3 in the SAME folder as this html -->
  <audio id="sfx" src="drum-roll2.mp3" preload="auto"></audio>

  <div class="wrap">
    <div class="card">
      <div class="row">
        <div class="pill">‡πÇ‡∏´‡∏°‡∏î: ‡∏™‡∏∏‡πà‡∏° 000‚Äì999 (‡πÄ‡∏•‡∏Ç‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ)</div>
        <div class="pill" id="status">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏∏‡πà‡∏°</div>
      </div>

      <div class="digits">
        <div class="digit" id="d1">‚Äì</div>
        <div class="digit" id="d2">‚Äì</div>
        <div class="digit" id="d3">‚Äì</div>
      </div>

      <div class="btns">
        <button id="start">üé∞ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç</button>
        <button class="secondary" id="reset">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
        <button class="secondary" id="clearHistory">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
        <button class="secondary" id="fullscreenBtn">Lock ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏ï‡πá‡∏°</button>
      </div>

      <p class="muted" style="margin-top:10px;">
        ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏Å‡∏î ‚Äú‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‚Äù ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å)
      </p>
    </div>

    <div class="card">
      <div class="row">
        <strong>üìú ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</strong>
        <span class="muted" id="count">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
      </div>
      <ul id="history"></ul>
    </div>
  </div>

<script>
  // ---------- Elements ----------
  const d1 = document.getElementById('d1');
  const d2 = document.getElementById('d2');
  const d3 = document.getElementById('d3');
  const statusEl = document.getElementById('status');

  const startBtn = document.getElementById('start');
  const resetBtn = document.getElementById('reset');
  const clearBtn = document.getElementById('clearHistory');
  const fullscreenBtn = document.getElementById('fullscreenBtn');

  const historyEl = document.getElementById('history');
  const countEl = document.getElementById('count');

  const sfx = document.getElementById('sfx');

  // ---------- State ----------
  let target = null;           // "XYZ"
  let running = false;
  let history = [];

  // ---------- Helpers ----------
  function pad3(n){ return String(n).padStart(3,'0'); }
  function setStatus(t){ statusEl.textContent = t; }

  function renderHistory(){
    historyEl.innerHTML = '';
    [...history].reverse().forEach(num => {
      const li = document.createElement('li');
      li.textContent = num;
      historyEl.appendChild(li);
    });
    countEl.textContent = `${history.length} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
  }

  function stopAudio(){
    try { sfx.pause(); sfx.currentTime = 0; } catch (_) {}
  }

  async function playAudioFromStart(){
    try {
      sfx.currentTime = 0;
      await sfx.play();
    } catch (_) {
      // If blocked by browser, user can click again.
    }
  }

  function resetScreen(){
    running = false;
    target = null;
    d1.textContent = '‚Äì';
    d2.textContent = '‚Äì';
    d3.textContent = '‚Äì';
    startBtn.disabled = false;
    setStatus('‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏∏‡πà‡∏°');
    stopAudio();
    stopConfetti();
  }

  function pickTarget(){
    const n = Math.floor(Math.random()*1000); // 0..999 (repeatable)
    target = pad3(n);
  }

  async function rollDigitFor(el, finalDigit, durationMs){
    const interval = 60;
    const start = performance.now();
    while (performance.now() - start < durationMs) {
      el.textContent = Math.floor(Math.random()*10);
      await new Promise(r => setTimeout(r, interval));
    }
    el.textContent = finalDigit;
  }

  async function runAuto7s(){
    // Total 7000ms -> match your mp3 timing so the end "tada" in the file hits nicely
    const t1 = 2300, t2 = 2300, t3 = 2400; // sum=7000
    setStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°‚Ä¶');

    await rollDigitFor(d1, target[0], t1);
    await rollDigitFor(d2, target[1], t2);
    await rollDigitFor(d3, target[2], t3);

    setStatus(`‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ${target}`);
    history.push(target);
    renderHistory();

    // Confetti on result (no extra sound ‚Äî your mp3 has its own ending)
    fireConfetti();
  }

  // ---------- Button handlers ----------
  startBtn.addEventListener('click', async () => {
    if (running) return;
    running = true;

    resetScreen();      // clears screen + stops old audio/confetti
    pickTarget();

    startBtn.disabled = true;
    await playAudioFromStart();
    await runAuto7s();

    running = false;
    startBtn.disabled = false;
    setStatus('‡∏Å‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ');
  });

  resetBtn.addEventListener('click', () => {
    resetScreen();
  });

  clearBtn.addEventListener('click', () => {
    history = [];
    renderHistory();
  });

  // Fullscreen "Lock"
  function setFullscreenUI(isFs){
    document.documentElement.classList.toggle('fullscreen', isFs);
    fullscreenBtn.textContent = isFs ? '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠' : 'Lock ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏ï‡πá‡∏°';
  }

  fullscreenBtn.addEventListener('click', async () => {
    try {
      if (!document.fullscreenElement) {
        await document.documentElement.requestFullscreen();
        setFullscreenUI(true);
      } else {
        await document.exitFullscreen();
        setFullscreenUI(false);
      }
    } catch (_) {}
  });

  document.addEventListener('fullscreenchange', () => {
    setFullscreenUI(!!document.fullscreenElement);
  });

  // ---------- Confetti ----------
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  let confetti = [];
  let confettiAnim = null;
  let confettiEndAt = 0;

  function resizeCanvas(){
    canvas.width = window.innerWidth * devicePixelRatio;
    canvas.height = window.innerHeight * devicePixelRatio;
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function rand(min,max){ return Math.random()*(max-min)+min; }

function fireConfetti(){
  resizeCanvas();
  const countPerSide = 120;   // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏á
  const w = window.innerWidth;
  const h = window.innerHeight;

  confetti = [];

  // ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢
  for(let i=0;i<countPerSide;i++){
    confetti.push({
      x: 0,
      y: h * 0.5 + rand(-120, 120),
      vx: rand(4, 9),
      vy: rand(-6, -12),
      g: rand(0.12, 0.22),
      r: rand(6, 12),
      rot: rand(0, Math.PI*2),
      vr: rand(-0.25, 0.25),
      color: `hsl(${Math.floor(rand(0,360))} 90% 55%)`,
      life: rand(80, 140)
    });
  }

  // ‡∏¢‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏ß‡∏≤
  for(let i=0;i<countPerSide;i++){
    confetti.push({
      x: w,
      y: h * 0.5 + rand(-120, 120),
      vx: rand(-9, -4),
      vy: rand(-6, -12),
      g: rand(0.12, 0.22),
      r: rand(6, 12),
      rot: rand(0, Math.PI*2),
      vr: rand(-0.25, 0.25),
      color: `hsl(${Math.floor(rand(0,360))} 90% 55%)`,
      life: rand(80, 140)
    });
  }

  confettiEndAt = performance.now() + 2500; // ~2.5 ‡∏ß‡∏¥
  if (confettiAnim) cancelAnimationFrame(confettiAnim);
  animateConfetti();
}


  function stopConfetti(){
    confetti = [];
    if (confettiAnim) cancelAnimationFrame(confettiAnim);
    confettiAnim = null;
    ctx.clearRect(0,0,canvas.width,canvas.height);
  }

  function animateConfetti(){
    const now = performance.now();
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

    confetti.forEach(p => {
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.life -= 1;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
      ctx.restore();
    });

    confetti = confetti.filter(p => p.life > 0 && p.y < window.innerHeight + 80);

    if (now < confettiEndAt && confetti.length > 0){
      confettiAnim = requestAnimationFrame(animateConfetti);
    } else {
      stopConfetti();
    }
  }

  // init
  renderHistory();
</script>
</body>
</html>
